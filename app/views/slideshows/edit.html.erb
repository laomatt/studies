  <center>
<div class="form-container panel">
  <h3>Edit title</h3>
<form id="save_slide" action="/slideshows/update_slide_show" method="post">
  <input type="hidden" value="<%= form_authenticity_token %>" name="authenticity_token"/>
  <label for="info[title]">Title</label>
  <input type="hidden" name="id" value="<%= @slideshow.id %>">
  <input type="text" id="edit_title" value="<%= @slideshow.title %>" name="info[title]">
  <input type="submit">
</form>
  <div class="success">Updated</div>
<br>
<br>
   <script>
     $(function() {
       $( "#sortable" ).sortable();
       $( "#sortable" ).disableSelection();
     });

     $('#sortable').draggable();
   </script>
    <h3>Add Images</h3>
    <%= form_for @slideshow, :html => {:id => 'upload'} do |f| %>
      <%= f.file_field :picture %>
    <% end %>
    <br><br>
    <button class="upload-button" id="upload-pic">Upload</button>
<h3>Slide Order</h3>
<p>Click and draw each slide to its disired position.</p>
<div id="info" ssid="<%= @slideshow.id %>"></div>
<ul id="sortable" class="slideshow_lists_edit">
  <% @images.each do |image|%>
    <% if !image.deleted %>
      <li class="entry" pic-id="<%= image.id %>" ssid="<%= @slideshow.id %>">
        <img src="<%= image.ext_url %>">
        <br>
        <div class="pic-info">
          <a href="#">
            <i class="fa fa-info-circle"></i>
          </a>
          <a href="#">
            <i class="fa fa-pencil-square-o"></i>
          </a>
          <a href="#">
            <i class="fa fa-trash"></i>
          </a>
        </div>
      </li>
    <% end %>
  <% end %>
</ul>
</div>
</center>

<script id="entry-template" type="text/x-handlebars-template">
  <li class="entry">
    <img src="{{ext_url}}">
    <br>
    <div class="pic-info">
      <i class="fa fa-info-circle"></i>
      <i class="fa fa-pencil-square-o"></i>
      <i class="fa fa-trash"></i>
    </div>
  </li>
</script>

<script>
  $('body').on('mouseup', '.slideshow_lists li', function(event) {
    event.preventDefault();
    var ss_id = $(this).attr('ssid');
    setTimeout(function(){
      $.each($(".slideshow_lists li"), function(index, val) {
        console.log(val, index)
        var id = $(this).attr("pic-id")
        $.ajax({
          url: '/slideshows/update_image_position',
          type: 'PUT',
          data: {position: index, slide_id: id, id: ss_id},
        })
      });
    }, 500)
    successFunction();
  });
  $("body").on('submit', 'form#save_slide', function(event) {
    event.preventDefault();
    var path = $(this).attr('action');
    $.ajax({
      url: path,
      type: 'POST',
      data: $(this).serialize(),
    })
    .done(function(data) {
      console.log("success");
      successFunction();

    })
  });

  var successFunction = function(){
        $(".success").fadeIn(1000, function() {
          $(this).fadeOut(1500, function() {
          });
        });
  }

  $('body').on('mouseenter', '.slideshow_lists li', function(event) {
    event.preventDefault();
    $(this).find('.pic-info').fadeIn(300, function() {});
  });

  $('body').on('mouseleave', '.slideshow_lists li', function(event) {
    event.preventDefault();
    $(this).find('.pic-info').fadeOut(300, function() {});
  });


  $('body').on('click', '#upload-pic', function(event) {
    event.preventDefault();
    $('form#upload').trigger('submit');
  });

    $("body").on('submit', 'form#upload', function(event) {
    event.preventDefault();
    var id = $("#info").attr('ssid');
    $('body').css('opacity', .5);

    $.ajax({
      url: "/home/"+id+"/add_image",
      type: 'PATCH',
      data: new FormData( this ),
      processData: false,
      contentType: false,
    })
    .done(function(data) {
      var source = $("#entry-template").html();
      var template = Handlebars.compile(source);
      var context = data;
      var html = template(context);
      $("ul.slideshow_lists").append(html);

      $("form#upload").trigger('reset');
      $('body').css('opacity', 1);
    })
  });


</script>